---
import "../styles/global.css";
import "@/styles/global.css";
import Header from "@/components/layout/Header.astro";
import Footer from "@/components/layout/Footer.astro";
import { ClientRouter } from "astro:transitions";
import ScrollToTopButton from "@repo/ui/components/ScrollToTopButton";
import MovingDotsBackground from "@/components/motion/MovingBackground";

type Props = {
  title: string;
  isBackgroundDots?: boolean;
  twitterTitle?: string;
  twitterImage?: string;
  twitterImageAlt?: string;
  twitterDescription?: string;
  ogTitle?: string;
  ogImage?: string;
  ogDescription?: string;
  ogImageAlt?: string;
};
const {
  title,
  isBackgroundDots = true,
  twitterTitle = "Friedrich WT",
  twitterImage = "https://friedrichwt.dev/og.png",
  twitterImageAlt = "Friedrich Wekenon Tokponto's Portfolio",
  twitterDescription = "Friedrich Wekenon Tokponto's Portfolio",
  ogTitle = "Friedrich WT",
  ogImage = "https://friedrichwt.dev/og.png",
  ogDescription = "Friedrich Wekenon Tokponto's Portfolio",
  ogImageAlt = "Friedrich Wekenon Tokponto's Portfolio",
} = Astro.props;
---

<script is:inline>
  function setDarkMode(document) {
    const getThemePreference = () => {
      if (
        typeof localStorage !== "undefined" &&
        localStorage.getItem("theme")
      ) {
        return localStorage.getItem("theme");
      }
      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    };

    const isDark = getThemePreference() === "dark";
    document.documentElement.classList[isDark ? "add" : "remove"]("dark");

    if (typeof localStorage !== "undefined") {
      const observer = new MutationObserver(() => {
        const isDark = document.documentElement.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ["class"],
      });
    }
  }

  setDarkMode(document);

  document.addEventListener("astro:before-swap", (ev) => {
    setDarkMode(ev.newDocument);
  });
</script>

<html lang="en">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta name="generator" content={Astro.generator} />
  <meta name="description" content="Friedrich Wekenon Tokponto" />
  <meta name="author" content="Friedrich Wekenon Tokponto" />
  <meta
    http-equiv="content-Security-Policy"
    content="upgrade-insecure-requests"
  />
  <link rel="icon" href="/favicon.svg" type="image/x-icon" sizes="48x48" />
  <link rel="canonical" href={new URL(Astro.url.pathname, Astro.site).href} />
  <link rel="sitemap" href="/sitemap-index.xml" />

  <!--Open Graph tags-->
  <meta property="og:title" content={ogTitle} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://friedrichwt.dev" />
  <meta property="og:description" content={ogDescription} />
  <meta property="og:image" content={ogImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content={ogImageAlt} />

  <!-- twitter tags -->
  <meta name="twitter:title" content={twitterTitle} />
  <meta name="twitter:image" content={twitterImage} />
  <meta name="twitter:image:alt" content={twitterImageAlt} />
  <meta name="twitter:creator" content="@FriedrichC109" />
  <meta name="twitter:description" content={twitterDescription} />
  <meta name="twitter:card" content="summary_large_image" />

  <title>{title}</title>

  <ClientRouter />
  <body class="flex h-dvh w-svw flex-col overflow-x-hidden">
    <Header />
    <slot />
    <ScrollToTopButton client:load />
    <Footer />
    {
      isBackgroundDots ? (
        <MovingDotsBackground client:load numDots={300} className="fixed" />
      ) : null
    }
  </body>
</html>
